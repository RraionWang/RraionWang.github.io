# å°ç…§ç›¸æœºv1.0

## å”®ä»·

<h1>99å…ƒ+é‚®è´¹ï¼ˆä¸å¸¦å­˜å‚¨å¡ï¼‰</h1>

## å®ç‰©è§†é¢‘
<video
  src="/assets/minicam_v1_0/v1.0_preview.mp4"
  controls
  autoplay
  muted
  loop
  playsinline
  style=" width:50%; height:auto; border-radius:12px;">
  ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
</video>

## æ¥å£è¯´æ˜
<img src="/assets/minicam_v1_0/v1.0_interface.png" alt="alt text" style="width:70%; height:auto;" />

## å®æ‹ç…§ç‰‡



## ä½¿ç”¨è§†é¢‘
<video
  src="/assets/minicam_v1_0/v1.0_tutorial.mp4"
  controls
  autoplay
  muted
  loop
  playsinline
  style=" width:50%; height:auto; border-radius:12px;">
  ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
</video>






## æ»¤é•œåŠŸèƒ½åœ¨çº¿é¢„è§ˆ



<style>
.control-bar {
  display: flex;
  gap: 12px;
  align-items: center;
  margin: 12px 0 6px;
  flex-wrap: wrap;
}

.upload-btn {
  padding: 7px 14px;
  border-radius: 8px;
  border: 1px solid #ddd;
  background: linear-gradient(180deg, #fff, #f3f3f3);
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s ease;
  user-select: none;
}

.upload-btn:hover {
  border-color: #999;
  background: #fff;
}

#filterSelect {
  padding: 7px 36px 7px 12px;
  border-radius: 8px;
  border: 1px solid #ddd;
  background: #ffffff url("data:image/svg+xml,%3Csvg width='10' height='6' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23999'/%3E%3C/svg%3E") no-repeat right 10px center;
  background-size: 10px 6px;
  font-size: 13px;
  cursor: pointer;
  appearance: none;
  transition: all 0.2s ease;
}

#filterSelect:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 2px rgba(59,130,246,0.15);
}

.preview-row {
  display: flex;
  gap: 24px;
  margin-top: 16px;
  flex-wrap: wrap;
}

.preview-box {
  width: 35%;
  background: #fafafa;
  padding: 12px;
  border-radius: 12px;
}

.preview-box canvas {
  width: 100%;
  height: auto;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.preview-box p {
  margin: 0 0 8px;
  font-size: 13px;
  font-weight: 500;
  color: #444;
}

#filterTip {
  font-size: 12px;
  color: #666;
  margin-top: 6px;
}

@media (max-width: 800px) {
  .preview-box {
    width: 100%;
  }
}
</style>

<div class="control-bar">
  <label class="upload-btn">
    ğŸ“‚ é€‰æ‹©å›¾ç‰‡
    <input type="file" id="fileInput" accept="image/*" hidden>
  </label>

  <select id="filterSelect">
    <option value="none">åŸå›¾</option>
    <option value="dreamcore">Dreamcore 00s</option>
    <option value="soft_memory">Soft Memoryï¼ˆç«¥å¹´å¤±ç„¦ï¼‰</option>
    <option value="organza">Organzaï¼ˆæ¬§æ ¹çº±ï¼‰</option>
    <option value="halftone">Halftone Comicï¼ˆæ¼«ç”»ç½‘ç‚¹ï¼‰</option>
    <option value="oil">Oil Paintingï¼ˆæ²¹ç”»é£ï¼‰</option>

    <option disabled>â”€â”€ å¸¸è§„é£æ ¼ â”€â”€</option>
    <option value="bw">Black & White</option>
    <option value="warm">Warm Retro</option>
    <option value="cold">Cold Blue</option>
    <option value="vhs">VHS å™ªç‚¹</option>
    <option value="pixel">Pixel Art</option>
    <option value="over">Overexposed Digital</option>
    <option value="cctv">CCTV Green</option>
    <option value="lomo">Lomo</option>

    <option disabled>â”€â”€ å•è‰²å¼ºå¯¹æ¯” â”€â”€</option>
    <option value="mono_red">Mono Red</option>
    <option value="mono_yellow">Mono Yellow</option>
    <option value="mono_blue">Mono Blue</option>
    <option value="mono_purple">Mono Purple</option>
    <option value="mono_green">Mono Green</option>
    <option value="mono_cyan">Mono Cyan</option>
    <option value="mono_orange">Mono Orange</option>
    <option value="mono_pink">Mono Pink</option>
    <option value="mono_teal">Mono Teal</option>
    <option value="mono_white">Mono White</option>
  </select>
</div>

<div id="filterTip">å½“å‰æ»¤é•œï¼šåŸå›¾</div>

<div class="preview-row">
  <div class="preview-box">
    <p>åŸå›¾</p>
    <canvas id="src"></canvas>
  </div>
  <div class="preview-box">
    <p>é¢„è§ˆ</p>
    <canvas id="dst"></canvas>
  </div>
</div>

<script>
const src = document.getElementById("src");
const dst = document.getElementById("dst");
const sctx = src.getContext("2d");
const dctx = dst.getContext("2d");
const select = document.getElementById("filterSelect");

let img = new Image();

fileInput.onchange = e => {
  img.src = URL.createObjectURL(e.target.files[0]);
};

img.onload = () => {
  src.width = dst.width = img.width;
  src.height = dst.height = img.height;
  sctx.drawImage(img,0,0);
  apply();
};

select.onchange = apply;

function apply(){
  dctx.drawImage(img,0,0);
  let imgData = dctx.getImageData(0,0,dst.width,dst.height);
  let d = imgData.data;

  switch(select.value){
    case "dreamcore": dreamcore(d); break;
    case "soft_memory": softMemory(d); break;

    case "bw": bw(d); break;
    case "warm": warm(d); break;
    case "cold": cold(d); break;
    case "vhs": vhs(d); break;
    case "pixel": pixel(); return;
    case "over": over(d); break;
    case "cctv": cctv(d); break;
    case "lomo": lomo(d); break;

    case "mono_red": mono(d,255,0,0); break;
    case "mono_yellow": mono(d,255,255,0); break;
    case "mono_blue": mono(d,0,120,255); break;
    case "mono_purple": mono(d,180,0,255); break;
    case "mono_green": mono(d,0,255,0); break;
    case "mono_cyan": mono(d,0,255,255); break;
    case "mono_orange": mono(d,255,140,0); break;
    case "mono_pink": mono(d,255,80,160); break;
    case "mono_teal": mono(d,0,180,160); break;
    case "mono_white": mono(d,255,255,255); break;
    case "organza": organza(d); break;
    case "halftone": halftone(); return;
case "oil": oilPaint(d); break;


  }

  dctx.putImageData(imgData,0,0);
}

/* ===== åŸºç¡€æ»¤é•œ ===== */
function bw(d){
  for(let i=0;i<d.length;i+=4){
    let g=(d[i]+d[i+1]+d[i+2])/3;
    d[i]=d[i+1]=d[i+2]=g;
  }
}

function warm(d){
  for(let i=0;i<d.length;i+=4){
    d[i]+=30; d[i+1]+=15;
  }
}

function cold(d){
  for(let i=0;i<d.length;i+=4){
    d[i+2]+=30;
  }
}

/* ===== VHS ===== */
function vhs(d){
  const w = dst.width;
  const h = dst.height;

  for(let y=0;y<h;y++){
    // æ¯ä¸€è¡Œä¸€ä¸ªå™ªå£°åŸºå‡†
    let lineNoise = (Math.random()-0.5) * 120;

    for(let x=0;x<w;x++){
      let i = (y*w + x) * 4;

      // åƒç´ çº§ç»†å™ªç‚¹
      let pixelNoise = (Math.random()-0.5) * 30;

      let n = lineNoise + pixelNoise;

      d[i]   += n;
      d[i+1] += n;
      d[i+2] += n;
    }
  }

  scanline(d);
}



/* ===== Pixel Art ===== */
function pixel(){
  const scale=4;
  dctx.imageSmoothingEnabled=false;
  dctx.drawImage(dst,0,0,dst.width/scale,dst.height/scale);
  dctx.drawImage(dst,0,0,dst.width/scale,dst.height/scale,0,0,dst.width,dst.height);
}

/* ===== Overexposed ===== */
function over(d){
  for(let i=0;i<d.length;i+=4){
    d[i]+=50; d[i+1]+=50; d[i+2]+=50;
  }
}

/* ===== CCTV Green ===== */
function cctv(d){
  for(let i=0;i<d.length;i+=4){
    let g=(d[i]+d[i+1]+d[i+2])/3;
    d[i]=0;
    d[i+1]=g*1.2;
    d[i+2]=0;
  }
  scanline(d);
}

/* ===== Lomo ===== */
function lomo(d){
  for(let i=0;i<d.length;i+=4){
    d[i]+=20;
    d[i+2]-=20;
  }
}

/* ===== Dreamcore ===== */
function dreamcore(d){
  for(let i=0;i<d.length;i+=4){
    d[i]=d[i]*0.9+20;
    d[i+1]=d[i+1]*0.95+10;
    d[i+2]=d[i+2]*1.05;
    if(Math.random()<0.02){
      d[i]+=30; d[i+1]+=30; d[i+2]+=30;
    }
  }
  scanline(d);
}

/* ===== Soft Memory ===== */
function softMemory(d){
  const w=dst.width,h=dst.height;
  boxBlur(d,w,h);
  boxBlur(d,w,h);

  for(let i=0;i<d.length;i+=4){
    let gray=(d[i]+d[i+1]+d[i+2])/3;
    if(gray>160){
      d[i]+=50; d[i+1]+=50; d[i+2]+=50;
    }
    d[i]=d[i]*0.65+40;
    d[i+1]=d[i+1]*0.65+35;
    d[i+2]=d[i+2]*0.65+30;
  }
}

/* ===== å•è‰²å¼ºå¯¹æ¯” ===== */
function mono(d,r,g,b){
  for(let i=0;i<d.length;i+=4){
    let gray=(d[i]+d[i+1]+d[i+2])/3;
    if(gray>120){ d[i]=r; d[i+1]=g; d[i+2]=b; }
    else{ d[i]=d[i+1]=d[i+2]=0; }
  }
}

/* ===== å·¥å…· ===== */
function scanline(d){
  const w=dst.width;
  for(let y=0;y<dst.height;y+=2){
    for(let x=0;x<w;x++){
      let i=(y*w+x)*4;
      d[i]*=0.9; d[i+1]*=0.9; d[i+2]*=0.9;
    }
  }
}

function boxBlur(d,w,h){
  const c=new Uint8ClampedArray(d);
  for(let y=1;y<h-1;y++){
    for(let x=1;x<w-1;x++){
      let r=0,g=0,b=0;
      for(let dy=-1;dy<=1;dy++)
        for(let dx=-1;dx<=1;dx++){
          let i=((y+dy)*w+(x+dx))*4;
          r+=c[i]; g+=c[i+1]; b+=c[i+2];
        }
      let i=(y*w+x)*4;
      d[i]=r/9; d[i+1]=g/9; d[i+2]=b/9;
    }
  }
}

function organza(d){
  const w = dst.width;
  const h = dst.height;

  // æ‹·è´ä¸€å±‚â€œçº±â€
  const veil = new Uint8ClampedArray(d);

  // 1ï¸âƒ£ å¯¹â€œçº±â€åšéå¸¸è½»çš„ blurï¼ˆä¸æ˜¯ç³Šï¼‰
  boxBlur(veil, w, h);

  // 2ï¸âƒ£ è½»å¾®åç§»ï¼ˆæ¨¡æ‹Ÿçº±çš„ç©ºé—´æ„Ÿï¼‰
  const shiftX = 1;
  const shiftY = 1;

  for(let y=0;y<h;y++){
    for(let x=0;x<w;x++){
      let i = (y*w + x) * 4;

      let vx = Math.min(w-1, Math.max(0, x + shiftX));
      let vy = Math.min(h-1, Math.max(0, y + shiftY));
      let vi = (vy*w + vx) * 4;

      // 3ï¸âƒ£ åŸå›¾ + çº±å±‚å åŠ ï¼ˆéå¸¸å…‹åˆ¶ï¼‰
      d[i]   = d[i]*0.75 + veil[vi]*0.25;
      d[i+1] = d[i+1]*0.75 + veil[vi+1]*0.25;
      d[i+2] = d[i+2]*0.75 + veil[vi+2]*0.25;
    }
  }

  // 4ï¸âƒ£ äº®éƒ¨æŸ”å…‰ï¼ˆä¸ç‚¸ï¼‰
  for(let i=0;i<d.length;i+=4){
    let gray = (d[i]+d[i+1]+d[i+2]) / 3;
    if(gray > 190){
      d[i]   += 15;
      d[i+1] += 15;
      d[i+2] += 15;
    }
  }

  // 5ï¸âƒ£ è½»å¾®é™é¥±å’Œï¼ˆä¸åè‰²ï¼‰
  for(let i=0;i<d.length;i+=4){
    let g = (d[i]+d[i+1]+d[i+2]) / 3;
    d[i]   = d[i]*0.9 + g*0.1;
    d[i+1] = d[i+1]*0.9 + g*0.1;
    d[i+2] = d[i+2]*0.9 + g*0.1;
  }

  // 6ï¸âƒ£ æè½»çš„çº¤ç»´æ„Ÿï¼ˆæ–¹å‘æ€§ï¼‰
  for(let y=0;y<h;y+=4){
    for(let x=0;x<w;x++){
      let i = (y*w + x) * 4;
      d[i]   *= 0.98;
      d[i+1] *= 0.98;
      d[i+2] *= 0.98;
    }
  }
}

function halftone(){
  const w = dst.width, h = dst.height;

  // ===== å¯è°ƒå‚æ•° =====
  const step = 7;                 // ç½‘ç‚¹é—´è·
  const maxR = step * 0.55;       // æœ€å¤§ç‚¹åŠå¾„
  const whiteCut = 235;           // äº®éƒ¨ç•™ç™½é˜ˆå€¼
  const gamma = 1.1;              // æ˜æš—æ›²çº¿
  const paper = [245,245,240];    // çº¸åº•è‰²ï¼ˆç™½/ç±³ç™½ï¼‰

  // ===== å–åŸå›¾åƒç´ ç”¨äºé‡‡æ · =====
  dctx.imageSmoothingEnabled = true;
  dctx.drawImage(img, 0, 0, w, h);
  const src = dctx.getImageData(0, 0, w, h).data;

  // ===== é“ºçº¸åº• =====
  dctx.clearRect(0,0,w,h);
  dctx.fillStyle = `rgb(${paper[0]},${paper[1]},${paper[2]})`;
  dctx.fillRect(0,0,w,h);

  // ===== ç”»å½©è‰²ç‚¹ =====
  for(let y=0; y<h; y+=step){
    for(let x=0; x<w; x+=step){
      const i = (y*w + x) * 4;
      const r = src[i], g = src[i+1], b = src[i+2];

      // æ„ŸçŸ¥äº®åº¦
      let lum = 0.2126*r + 0.7152*g + 0.0722*b;
      if (lum >= whiteCut) continue; // äº®éƒ¨ç•™ç™½

      // ç‚¹åŠå¾„ï¼ˆæš—->å¤§ï¼‰
      let t = 1 - (lum / whiteCut);
      t = Math.pow(t, gamma);
      const radius = maxR * t;
      if (radius < 0.35) continue;

      // ===== é¢œè‰²é‡åŒ–ï¼ˆå…³é”®ï¼šå°åˆ·æ„Ÿï¼‰=====
      const qr = Math.round(r / 64) * 64;
      const qg = Math.round(g / 64) * 64;
      const qb = Math.round(b / 64) * 64;

      dctx.fillStyle = `rgb(${qr},${qg},${qb})`;
      dctx.beginPath();
      dctx.arc(x, y, radius, 0, Math.PI*2);
      dctx.fill();
    }
  }
}

function oilPaint(d){
  const w = dst.width;
  const h = dst.height;

  const radius = 3;      // ç¬”è§¦åŠå¾„ï¼ˆ2~5ï¼‰
  const levels = 16;     // é¢œè‰²ç­‰çº§ï¼ˆè¶Šä½è¶Šæ²¹ç”»ï¼‰

  const copy = new Uint8ClampedArray(d);

  for(let y=0;y<h;y++){
    for(let x=0;x<w;x++){
      let intensityCount = new Array(levels).fill(0);
      let rSum = new Array(levels).fill(0);
      let gSum = new Array(levels).fill(0);
      let bSum = new Array(levels).fill(0);

      for(let dy=-radius; dy<=radius; dy++){
        for(let dx=-radius; dx<=radius; dx++){
          let nx = x + dx;
          let ny = y + dy;
          if(nx<0 || ny<0 || nx>=w || ny>=h) continue;

          let i = (ny*w + nx) * 4;
          let r = copy[i];
          let g = copy[i+1];
          let b = copy[i+2];

          let intensity = ((r+g+b)/3 * levels / 256) | 0;
          intensity = Math.min(levels-1, intensity);

          intensityCount[intensity]++;
          rSum[intensity] += r;
          gSum[intensity] += g;
          bSum[intensity] += b;
        }
      }

      // æ‰¾å‡ºç°æ¬¡æ•°æœ€å¤šçš„â€œé¢œè‰²åŒºé—´â€
      let maxIdx = 0;
      for(let i=1;i<levels;i++){
        if(intensityCount[i] > intensityCount[maxIdx]){
          maxIdx = i;
        }
      }

      let idx = (y*w + x) * 4;
      let count = intensityCount[maxIdx] || 1;

      d[idx]   = rSum[maxIdx] / count;
      d[idx+1] = gSum[maxIdx] / count;
      d[idx+2] = bSum[maxIdx] / count;
    }
  }
}



</script>

## å¼€æºé“¾æ¥
|åœ°å€|è¯´æ˜|
|-|-|
|[githubé“¾æ¥](https://github.com/RraionWang/cam_ui)|ä½¿ç”¨esp32s3 camçš„æ¿å­ï¼Œå¤–è®¾æ‹“å±•æ¿ï¼Œ3dæ–‡ä»¶å’ŒPCBæ–‡ä»¶éƒ½åœ¨å·¥ç¨‹ç›®å½•ä¸­|
